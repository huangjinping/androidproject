/** 
 * Project Name：Westinghouse 
 * File Name：AutoScrollView.java 
 * Package Name：cn.cooperlink.attea.view.autoscrollpager 
 * Date：2015-1-31 上午9:25:52 
 * Copyright (c) 2015, cooperlink.cn All Rights Reserved. 
 * 北京酷博灵科信息技术有限公司
 */
package cn.cooperlink.privatetutor.view.autoscrollview;

import java.util.ArrayList;
import java.util.List;
import java.util.Map;

import android.annotation.SuppressLint;
import android.app.Activity;
import android.content.Context;
import android.util.AttributeSet;
import android.util.DisplayMetrics;
import android.view.MotionEvent;
import android.view.View;
import android.widget.ImageView;
import android.widget.ImageView.ScaleType;
import android.widget.LinearLayout;
import cn.cooperlink.privatetutor.R;

/**
 * @Title：轮播图
 * @Description：
 * @Package cn.cooperlink.attea.view.autoscrollpager
 * @ClassName AutoScrollView
 * @author harris
 * @date 2015-1-31 上午9:25:52
 * @version
 */
@SuppressLint("ClickableViewAccessibility")
public class AutoScrollView extends LinearLayout {
  


	private AutoScrollViewPager vip_autoscroll;
	private LinearLayout layout_indicator;
	/**
	 * @Fields dataList: 数据源
	 */

	List<View> viewList;
	private Context context;

	private List<Map<String, Object>> dataAllList;
	private DisplayMetrics metrics;

	public AutoScrollView(Context context) {
		super(context);
		this.context =  context;
		initView(context);
	}
	public AutoScrollView(Context context, AttributeSet attrs) {
		super(context, attrs);
		this.context =  context;
		initView(context);
	}
	private void initView(Context context) {
		// TODO Auto-generated method stub
		this.setOrientation(LinearLayout.VERTICAL);

		dataAllList = new ArrayList<Map<String, Object>>();

		View view = View.inflate(context, R.layout.layout_autoscrollviewpager,
				null);
		vip_autoscroll = (AutoScrollViewPager) view
				.findViewById(R.id.vip_autoscroll);
		layout_indicator = (LinearLayout) view
				.findViewById(R.id.layout_indicator);
		metrics = new DisplayMetrics();
		((Activity) context).getWindowManager().getDefaultDisplay().getMetrics(metrics);
		int w = metrics.widthPixels;
		int h = (metrics.widthPixels * 130) / 320;
		LinearLayout.LayoutParams params = new LinearLayout.LayoutParams(w, h);
		this.addView(view, params);
		
		

		vip_autoscroll.setOnTouchListener(new OnTouchListener() {

			@Override
			public boolean onTouch(View v, MotionEvent event) {
				// TODO Auto-generated method stub

				switch (event.getAction()) {
				case MotionEvent.ACTION_DOWN:
					vip_autoscroll.stopTimer();

					break;
				case MotionEvent.ACTION_UP:
					vip_autoscroll.startTimer();

					break;
				}

				return true;
			}
		});
	}

	public void initCarouslview(List<Map<String, Object>> dataList) {
		// TODO Auto-generated method stub
		this.dataAllList = dataList;

		if (dataList == null || dataList.size() == 0) {
			this.setVisibility(View.GONE);
			return;
		}
		this.setVisibility(View.VISIBLE);
		viewList = new ArrayList<View>();

		for (int i = 0; i < dataList.size(); i++) {
			ImageView imageView = new ImageView(context);
			imageView.setOnClickListener(new OnClickListener() {
				public void onClick(View v) {// 设置图片点击事件
//					Map<String, Object> event = (Map<String, Object>) dataAllList
//							.get(vip_autoscroll.getCurIndex()).get("event");
//					eventIntent(event);
				}
			});
			Map<String, Object> map = dataList.get(i);
			String imageUrl = (String) map.get("imageUrl");
//			imageLoader.displayImage(NetConst.imageUrl(imageUrl), imageView, options);
			imageView.setScaleType(ScaleType.FIT_CENTER);
			viewList.add(imageView);
		}
		vip_autoscroll.start((Activity)context, viewList, 4000, layout_indicator,
				R.layout.ad_bottom_item, R.id.ad_item_v,
				R.drawable.dot_focused, R.drawable.dot_normal);
	}

	public void onRestart() {
		if (vip_autoscroll.isStoped) {
			vip_autoscroll.startTimer();
		}

	}

	public void onStop() {
		vip_autoscroll.stopTimer();
	}
}
